<div class="card card-flush mb-6" *ngIf="showviewallTask">
  <div class="card-header">
    <h3 class="card-title text-gray-800 fw-bold">Recent Tasks</h3>

    <div class="card-toolbar"></div>
  </div>

  <div class="card-body pt-0 overflow-auto pos-relative min-height-200">
    <app-spinner *ngIf="showLoading== true"></app-spinner>

    <div *ngIf="taskList.length == 0 && showLoading == false">
      <div class="d-flex flex-column flex-grow-1">
        <span class="text-muted font-weight-bold">No Task Found</span>
      </div>
    </div>
    <div *ngIf="taskList.length > 0 && showviewallTask">
      <div class="mb-5" *ngFor="let task of taskList; let i=index">
        <div class="d-flex align-items-center">
          <div class="symbol symbol-45 symbol-light mr-5"></div>

          <div class="d-flex flex-column flex-grow-1">
            <a
              href="javascript:void(0)"
              class="font-weight-bold text-dark-75 text-gray-800 text-hover-gray font-size-lg mb-1"
              >{{task.message}}</a
            >
            <span class="text-muted font-weight-bold"
              >{{returnTime(task.updatedAt)}}</span
            >
          </div>
        </div>
      </div>
    </div>

  </div>

  <div
    *ngIf="showviewallTask && taskList.length > 0"
    class="d-flex flex-stack mt-auto bd-highlight j-c-r pd-10"
  >
    <a
      (click)="showAll()"
      href="javascript:void(0)"
      class="text-primary opacity-75-hover fs-6 fw-semibold"
      >View All

      <span class="svg-icon svg-icon-4 svg-icon-gray-800 ms-1">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            opacity="0.3"
            d="M4.7 17.3V7.7C4.7 6.59543 5.59543 5.7 6.7 5.7H9.8C10.2694 5.7 10.65 5.31944 10.65 4.85C10.65 4.38056 10.2694 4 9.8 4H5C3.89543 4 3 4.89543 3 6V19C3 20.1046 3.89543 21 5 21H18C19.1046 21 20 20.1046 20 19V14.2C20 13.7306 19.6194 13.35 19.15 13.35C18.6806 13.35 18.3 13.7306 18.3 14.2V17.3C18.3 18.4046 17.4046 19.3 16.3 19.3H6.7C5.59543 19.3 4.7 18.4046 4.7 17.3Z"
            fill="currentColor"
          ></path>
          <rect
            x="21.9497"
            y="3.46448"
            width="13"
            height="2"
            rx="1"
            transform="rotate(135 21.9497 3.46448)"
            fill="currentColor"
          ></rect>
          <path
            d="M19.8284 4.97161L19.8284 9.93937C19.8284 10.5252 20.3033 11 20.8891 11C21.4749 11 21.9497 10.5252 21.9497 9.93937L21.9497 3.05029C21.9497 2.498 21.502 2.05028 20.9497 2.05028L14.0607 2.05027C13.4749 2.05027 13 2.52514 13 3.11094C13 3.69673 13.4749 4.17161 14.0607 4.17161L19.0284 4.17161C19.4702 4.17161 19.8284 4.52978 19.8284 4.97161Z"
            fill="currentColor"
          ></path>
        </svg>
      </span>
    </a>
  </div>
</div>


<div
  id="kt_app_toolbar"
  class="app-toolbar py-3 py-lg-6"
  *ngIf="mode === 'list' && !showviewallTask && moduleId"
> 
  <!--begin::Toolbar container-->
  <div
    id="kt_app_toolbar_container"
    class="app-container container-fluid d-flex flex-stack"
  >
    <!--begin::Page title-->
    <div
      class="page-title d-flex flex-column justify-content-center flex-wrap me-3"
    ></div>
    <!--end::Page title-->
    <!--begin::Actions-->
    <div class="d-flex align-items-center gap-2 gap-lg-3">
      <!--begin::Primary button-->
      <a
        *ngIf="role !== 'Patient'"
        (click)="switchMode('new')"
        class="btn btn-sm fw-bold fs-btn py-1"
        ><!--begin::Svg Icon | path: /var/www/preview.keenthemes.com/kt-products/docs/metronic/html/releases/2022-08-29-071832/core/html/src/media/icons/duotune/arrows/arr087.svg-->
        <span class="svg-icon svg-icon-white svg-icon-2hx"
          >
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <rect
              opacity="0.5"
              x="11"
              y="18"
              width="12"
              height="2"
              rx="1"
              transform="rotate(-90 11 18)"
              fill="currentColor"
            />
            <rect
              x="6"
              y="11"
              width="12"
              height="2"
              rx="1"
              fill="currentColor"
            />
            </svg>

          </span>
        <!--end::Svg Icon-->New Task</a
      >
      <!--end::Primary button-->
    </div>
    <!--end::Actions-->
  </div>
  <!--end::Toolbar container-->
</div> 

<div id="kt_app_content" class="app-content flex-column-fluid pos-relative" *ngIf="!showviewallTask">
   <app-spinner *ngIf="showLoading==true"></app-spinner>
  <div id="kt_app_content_container" class="app-container container-xxl">
    <div *ngIf="mode === 'list'">
      <div *ngIf="taskList.length === 0 && showLoading == false" class="card mb-10">
        <div class="card-body d-flex align-items-center p-5 p-lg-8">
          No Tasks Found
        </div>
      </div>
      <div *ngIf="showLoading == false">
      <div class="card mb-10" *ngFor="let task of taskList; index as i">
        <div class="card-body cursor-pointer">
          <div class="row">
            <div class="col-sm-11" (click)="redirectTo(task)">
              <div class="mb-1">
                <span class="fw-bold fw-bold fs-sm-4">{{
                  task.message ? task.message : task.title
                }}</span
                >&nbsp; <span class="fs-span" *ngIf="task.url" (click)="redirectTo(task)">Click here to review</span>
              </div>

               <div class="mb-1 text-gray-800" *ngIf="task.desc != ''">
                <span class="fw-bold">Description:</span>&nbsp;
                <span class="text-muted font-weight-bold">
                  {{ task.desc }}
                </span>
              </div>


              <div class="mb-1 text-gray-800">
                <span class="fw-bold">Status:</span>&nbsp;
                <!-- <span class="text-muted font-weight-bold">
                  {{ task.status }}
                </span> -->
                <span class="badge me-10 text-capitalize" [ngClass]="{'badge-primary': task.status=='New','badge-info': task.status=='Pending', 'badge-warning': task.status=='Draft', 'badge-danger': task.status=='Hold','badge-success': task.status=='Complete'}">{{task.status}}</span>
              </div>

              <div class="mb-1 text-gray-800">
                <span class="fw-bold">Assigned To:</span>&nbsp;
                <span class="text-muted font-weight-bold">
                  {{
                    task.actorId && task.actorId.email
                      ? task.actorId.email
                      : "---"
                  }}
                </span>
              </div>

              <div class="mb-1 text-gray-800">
                <span class="fw-bold">Assigned By:</span>&nbsp;
                <span class="text-muted font-weight-bold">
                  {{
                    task.senderId && task.senderId.email
                      ? task.senderId.email
                      : "---"
                  }}</span
                >
              </div>

              <div class="mb-1 text-gray-800">
                <span class="fw-bold">Due Date:</span>&nbsp;
                <span class="text-muted font-weight-bold">
                  {{ task.dueDate | date: "MMM d, y" }}</span
                >
              </div>
            </div>

            <div class="col-sm-1 d-flex align-items-center justify-content-end">
              <div class="">
                <div ngbDropdown class="d-inline-block">
                  <span
                    class="svg-icon svg-icon-muted svg-icon-2hx cursor-pointer"
                    id="dropdownBasic1"
                    ngbDropdownToggle
                  >
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <rect
                        x="10"
                        y="10"
                        width="4"
                        height="4"
                        rx="2"
                        fill="currentColor"
                      />
                      <rect
                        x="10"
                        y="3"
                        width="4"
                        height="4"
                        rx="2"
                        fill="currentColor"
                      />
                      <rect
                        x="10"
                        y="17"
                        width="4"
                        height="4"
                        rx="2"
                        fill="currentColor"
                      />
                    </svg>
                  </span>

                  <div
                    ngbDropdownMenu
                    aria-labelledby="dropdownBasic1"
                    style=""
                    class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg menu-state-color fw-semibold py-4 fs-6 w-275px"
                  >
                    <div class="menu-item px-3" *ngFor="let status of taskStatus;" (click)="changeStatus(status,i)" ngbDropdownToggle>
                      <a class="menu-link">{{status}}</a>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

      <div class="row mt-sm-8" *ngIf="totalCount > 10">
        <div class="col-xl-12" style="">
          <div class="d-flex justify-content-center align-items-center flex-wrap">
            <div class="d-flex flex-wrap">
              <ngb-pagination (pageChange)="onPageChange($event)" [directionLinks]="true" [boundaryLinks]="true" [rotate]="true" [ellipses]="false" [collectionSize]="totalCount" [pageSize]="10" [maxSize]="5" [(page)]="page" aria-label="Default pagination"></ngb-pagination>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="mode === 'new'">
      
      <div class="card" style="width: 100%">
        <div class="card-header card-header-stretch overflow-auto p-0">
          <div class="card-title">
            <div class="d-flex justify-content-center flex-column me-3">
              <a
              href="javascript:void(0)"
              *ngIf="mode === 'new'"
              (click)="switchMode('list')"
              class="btn btn-sm fw-bold"
              ><!--begin::Svg Icon | path: /var/www/preview.keenthemes.com/kt-products/docs/metronic/html/releases/2022-08-29-071832/core/html/src/media/icons/duotune/arrows/arr022.svg-->
              <span class="svg-icon svg-icon-dark svg-icon-1hx"
                ><svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M17.6 4L9.6 12L17.6 20H13.6L6.3 12.7C5.9 12.3 5.9 11.7 6.3 11.3L13.6 4H17.6Z"
                    fill="currentColor"
                  />
                </svg>
              </span>
              <!--end::Svg Icon-->Back</a
            >
            </div>
          </div>
         
        </div>
        <div class="card-body align-items-center p-5 p-lg-8">
          <form
            class="form fv-plugins-bootstrap5 fv-plugins-framework"
            autocomplete="off"
            [formGroup]="taskForm"
            novalidate="novalidate"
            id="kt_modal_create_app_form"
          >
            <div
              class="d-flex flex-column mb-8 fv-row fv-plugins-icon-container"
            >
              <label class="d-flex align-items-center fs-6 fw-semibold mb-2">
                <span class="required">Name</span>
              </label>

              <input
                type="text"
                class="form-control"
                placeholder="Name"
                name="name"
                type="text"
                autocomplete="off"
                [formControl]="$any(taskForm.controls['name'])"
              />
              <small
                class="form-text text-danger"
                *ngIf="
                  (taskForm.controls['name'].status == 'INVALID' &&
                    taskForm.controls['name'].touched) ||
                  (taskForm.controls['name'].hasError('required') &&
                    taskForm.controls['name'].touched)
                "
                >Enter Name</small
              >
            </div>

            
            <div
              class="d-flex flex-column mb-8 fv-row fv-plugins-icon-container"
            >
              <label class="d-flex align-items-center fs-6 fw-semibold mb-2">
                <span class="">Description</span>
              </label>

              <textarea
                type="text"
                class="form-control"
                placeholder="add description..."
                type="text"
                name="description"
                autocomplete="off"
                [formControl]="$any(taskForm.controls['description'])"
              ></textarea>
            </div>

            <div
              class="d-flex flex-column mb-8 fv-row fv-plugins-icon-container fs-autocomplete-menu"
            >
              <label class="d-flex align-items-center fs-6 fw-semibold mb-2">
                <span class="required">Assign To</span>
              </label>

              <input
                type="text"
                class="form-control"
                placeholder="Assign To"
                type="text"
                name="assignTo"
                autocomplete="off"
                [formControl]="$any(taskForm.controls['assignTo'])"
                (keyup)="onSearchKeyup($event)"
                (focus)="onFocus($event)" 
                [attr.disabled]="isDisabled==true?true:null"
              />
              <small
                class="form-text text-danger"
                *ngIf="
                  (taskForm.controls['assignTo'].status == 'INVALID' &&
                    taskForm.controls['assignTo'].touched) ||
                  (taskForm.controls['assignTo'].hasError('required') &&
                    taskForm.controls['assignTo'].touched)
                "
                >AssignTo is required</small
              >
            </div>
 
            <div
              class="d-flex flex-column mb-8 fv-row fv-plugins-icon-container"
            >
              <label class="d-flex align-items-center fs-6 fw-semibold mb-2">
                <span class="required">Due Date</span>
              </label>

              <input
                type="text"
                class="form-control"
                placeholder="Due Date"
                type="date"
                name="dueDate"
                autocomplete="off"
                [formControl]="$any(taskForm.controls['dueDate'])"
                [min] = "minDate"
              />
              <small
                class="form-text text-danger"
                *ngIf="
                  (taskForm.controls['dueDate'].status == 'INVALID' &&
                    taskForm.controls['dueDate'].touched) ||
                  (taskForm.controls['dueDate'].hasError('required') &&
                    taskForm.controls['dueDate'].touched)
                "
                >Due Date is required</small
              >
            </div>

          </form>
        </div>

        <div class="card-footer d-flex py-8">
          <div class="float-right">
            <a
              href="javascript:void(0)"
              (click)="save()"
              class="btn btn-md fw-bold fs-btn"
              >save</a
            >
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
 
<div
  class="cust-list custom-search-list app-header-menu"
  (clickOutside)="onClickedOutside($event)"
  style="
    background-color: #fff;
    position: absolute;
    top: -90000000px;
    z-index: 999999999;
    border: 1px grey;
  "
> 
  <div
    class="menu menu-column menu-rounded menu-gray-800 menu-state-bg menu-state-color fw-semibold py-2 fs-6"
    style="
      border-color: lightgray;
      border-radius: 0.375rem;
      border-width: 0.5px;
      border-style: solid;
    "
  >
    <div
      class="menu-item px-3"
      (click)="selectitem(list); resetListPosition()"
      *ngFor="let list of searchList; index as d"
    >
      <a class="menu-link"
        >{{ list.name ? list.name : list.email }}
        <i>
          &nbsp; &nbsp; &nbsp; &nbsp;<span>{{ list.role.role }}</span></i
        ></a
      >
    </div>

    <div
      class="menu-item px-3"
      *ngIf="searchList.length == 0"
      (click)="resetListPosition()"
    >
      <a class="menu-link"> <span>No Matching Results</span> </a>
    </div>
  </div>
</div>





 
<ng-template #automated_workflow let-modal>
  <div class="modal-header">
    <h2 class="modal-title" id="modal-basic-title">
    Confirmation
    </h2>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
 
  Do you want to notify patient with next step?

  </div>
  <div class="modal-footer">
   

    <button
      (click)="notify(modal);"
      type="button"
      class="btn btn-sm btn-primary"
      data-kt-stepper-action="next"
    >
      Yes
      <span class="svg-icon svg-icon-3 ms-1 me-0"> </span>
    </button>

    <button
      (click)="close(modal);"
      type="button"
      class="btn btn-sm btn-default"
      data-kt-stepper-action="next"
    >
      No
      <span class="svg-icon svg-icon-3 ms-1 me-0"> </span>
    </button>

  </div>
</ng-template>

<button
  style="display: none"
  id="automated_workflow_confirmation"
  class="btn btn-lg btn-outline-primary"
  (click)="open(automated_workflow)"
>
Launch Automated workflow prompt
</button>
